!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){var c,d,e,f,g,h;g=4,f=10,h=6,c=a("./brick.coffee"),e=a("./brick-creator.coffee"),d=function(){function a(a){this.game=a,this.bc=this._initBrickCollection(),this._initWrapper(),this.$score=$("span#score"),this.score=0,this.brickCreator=new e(this),this.previousTipsBrick=[]}return a.prototype.restart=function(){return this._removeAllBricks(),this._resetScore()},a.prototype.addNewRow=function(){var a,b,d,e;for(b=this.nextBrickNums,e=[],a=d=0;3>=d;a=++d)e.push(this.bc[a][-1]=new c(b[a],{x:a,y:-1},this.$wrapper,a));return e},a.prototype.rowsUp=function(){var a,b,c,d,e;for(e=[],a=c=d=g-1;0>=d?0>=c:c>=0;a=0>=d?++c:--c)e.push(function(){var c,d;for(d=[],b=c=f;-1>=f?-1>=c:c>=-1;b=-1>=f?++c:--c)this.bc[a][b]?(this.bc[a][b].up(),this.bc[a][b+1]=this.bc[a][b],d.push(this.bc[a][b]=null)):d.push(void 0);return d}.call(this));return e},a.prototype.getAndShowNextRow=function(){return this.nextBrickNums=this.brickCreator.getNew(),this._showNextRow(this.nextBrickNums)},a.prototype.onTap=function(){var a;return a=this,this.$wrapper[0].addEventListener("touchstart",function(b){var c,d,e;return"brick"===b.target.className?(c=b.target,d=a._getPositionByDom(c),e=[],a._findAndReomveSameColorBricks(d,e),a._calculateFallDown(),setTimeout(function(){return a._findAndReomveMoreThanThreeNearByBricks(a.game.next)},300)):void 0})},a.prototype.checkThreeNear=function(){return this._findAndReomveMoreThanThreeNearByBricks()},a.prototype.checkIsEnd=function(){var a,b;for(a=b=0;3>=b;a=++b)if(this.bc[a][10])return!0;return!1},a.prototype._resetScore=function(){var a;return this.score=0,a=("0000"+this.score).slice(-4),this.$score.text(a)},a.prototype._removeAllBricks=function(){var a,b,c,d;for(d=[],a=c=0;3>=c;a=++c)d.push(function(){var c,d;for(d=[],b=c=0;12>=c;b=++c)this.bc[a][b]?(this.bc[a][b].remove(1.5),d.push(this.bc[a][b]=null)):d.push(void 0);return d}.call(this));return d},a.prototype._showNextRow=function(a){var b,d,e,f,g,h,i;for(h=this.previousTipsBrick,e=0,g=h.length;g>e;e++)b=h[e],b.remove();for(i=[],d=f=0;3>=f;d=++f)i.push(this.previousTipsBrick.push(new c(a[d],{x:d,y:0},this.$nextBrickWrapper,d,20,!0)));return i},a.prototype._initWrapper=function(){var a;return a=parseInt(window.innerHeight/10.5),this.$wrapper=$("div#wrapper"),this.$nextBrickWrapper=$("div#next-bricks-wrapper"),this.wrapperHeight=this.game.height,this.wrapperWidth=4*a+8,this.$wrapper.css({height:this.wrapperHeight,width:this.wrapperWidth}),$("div#right").css({width:this.game.width-this.wrapperWidth-h}),$("div.end-line").css("top",a/4)},a.prototype._calculateFallDown=function(){var a,b,c,d,e,h,i;for(i=[],c=e=0,h=g-1;h>=0?h>=e:e>=h;c=h>=0?++e:--e)i.push(function(){var e,g,h;for(h=[],d=e=0,g=f-1;g>=0?g>=e:e>=g;d=g>=0?++e:--e)this.bc[c][d]?h.push(void 0):(a=this._hasUpperBrick(c,d))?(b=a.position.y,this.bc[c][d]=a,this.bc[c][b]=null,h.push(a.down(a.position.y-d))):h.push(void 0);return h}.call(this));return i},a.prototype._hasUpperBrick=function(a,b){var c,d,e,g;for(c=d=e=b+1,g=f-1;g>=e?g>=d:d>=g;c=g>=e?++d:--d)if(this.bc[a][c])return this.bc[a][c];return null},a.prototype._removeBricks=function(a){var b,c,d,e,f,g,h,i,j,k;for(console.log("remove"),e=[],f=0,g=0,i=a.length;i>g;g++)b=a[g],d=b.x,-1===e.indexOf(d)&&(e.push(d),f+=d);for(c=f/e.length,k=[],h=0,j=a.length;j>h;h++)b=a[h],this._scoreUp(),this.bc[b.x][b.y].remove(c),k.push(this.bc[b.x][b.y]=null);return k},a.prototype._scoreUp=function(){var a;return this.score+=1,a=("0000"+this.score).slice(-4),this.$score.text(a)},a.prototype._findAndReomveMoreThanThreeNearByBricks=function(a){var b,c,d,e,h,i,j,k,l,m;for(e=[],h=j=0,l=g-1;l>=0?l>=j:j>=l;h=l>=0?++j:--j)for(i=k=0,m=f-1;m>=0?m>=k:k>=m;i=m>=0?++k:--k)c={x:h,y:i},(b=this.bc[h][i]&&!this._isPosInCollection(e,c))&&this._hasThreeSameColorBricks(c)&&(e.push(c),this._findNearBySameColorBricks(c,e));return e.length>0?(this._removeBricks(e),this._calculateFallDown(),d=this,setTimeout(function(){return d._findAndReomveMoreThanThreeNearByBricks(a)},300)):"function"==typeof a?a():void 0},a.prototype._hasThreeSameColorBricks=function(a){var b,c;return b=a.x,c=a.y,this._isVaildPosition({x:b,y:c+1})&&this._isVaildPosition({x:b,y:c+2})&&this._isTheSameColor(this.bc[b][c],this.bc[b][c+1])&&this._isTheSameColor(this.bc[b][c],this.bc[b][c+2])?!0:this._isVaildPosition({x:b+1,y:c})&&this._isVaildPosition({x:b+2,y:c})&&this._isTheSameColor(this.bc[b][c],this.bc[b+1][c])&&this._isTheSameColor(this.bc[b][c],this.bc[b+2][c])?!0:!1},a.prototype._findAndReomveSameColorBricks=function(a,b){return b.push(a),this._findNearBySameColorBricks(a,b),this._removeBricks(b)},a.prototype._findNearBySameColorBricks=function(a,b){return this._checkIsSameColorAndAdd(a,{x:a.x-1,y:a.y},b),this._checkIsSameColorAndAdd(a,{x:a.x+1,y:a.y},b),this._checkIsSameColorAndAdd(a,{x:a.x,y:a.y-1},b),this._checkIsSameColorAndAdd(a,{x:a.x,y:a.y+1},b)},a.prototype._checkIsSameColorAndAdd=function(a,b,c){var d,e;return this._isVaildPosition(b)&&(e=this.bc[b.x][b.y])&&!this._isPosInCollection(c,b)&&(d=this.bc[a.x][a.y],d.color===e.color)?(c.push(e.position),this._findNearBySameColorBricks(e.position,c)):void 0},a.prototype._isVaildPosition=function(a){return 0<=a.x&&a.x<=g-1&&0<=a.y&&a.y<=f-1},a.prototype._isTheSameColor=function(a,b){return a&&b?a.color===b.color:!1},a.prototype._getPositionByDom=function(a){var b,c;return b=parseInt($(a).attr("data-x")),c=parseInt($(a).attr("data-y")),{x:b,y:c}},a.prototype._isPosInCollection=function(a,b){var c,d,e;for(d=0,e=a.length;e>d;d++)if(c=a[d],c.x===b.x&&c.y===b.y)return!0;return!1},a.prototype._initBrickCollection=function(){var a;return a=[],a[0]=[],a[1]=[],a[2]=[],a[3]=[],a},a}(),b.exports=d},{"./brick-creator.coffee":2,"./brick.coffee":3}],2:[function(a,b){var c,d,e,f,g;g=[0,1,2],e=g[0],f=g[1],d=g[2],c=function(){function a(a){this.brickCtrl=a}return a.prototype.getNew=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;return f=this.brickCtrl.score,f>=0&&199>=f?(h=[30,60,10,4],c=h[0],d=h[1],e=h[2],a=h[3]):f>=200&&399>=f?(j=[20,60,20,4],c=j[0],d=j[1],e=j[2],a=j[3]):f>=400&&599>=f?(k=[10,50,40,4],c=k[0],d=k[1],e=k[2],a=k[3]):f>=600&&799>=f?(l=[0,30,70,5],c=l[0],d=l[1],e=l[2],a=l[3]):f>=800&&999>=f?(m=[0,10,90,5],c=m[0],d=m[1],e=m[2],a=m[3]):f>=1e3&&1199>=f?(n=[0,0,100,5],c=n[0],d=n[1],e=n[2],a=n[3]):f>=1200&&1799>=f?(o=[0,0,100,6],c=o[0],d=o[1],e=o[2],a=o[3]):f>=1800&&2399>=f?(p=[0,0,100,7],c=p[0],d=p[1],e=p[2],a=p[3]):f>=2400&&2999>=f?(q=[0,0,100,8],c=q[0],d=q[1],e=q[2],a=q[3]):(alert("爆机了"),i=[0,0,100,8],c=i[0],d=i[1],e=i[2],a=i[3]),g=this._getTypeByProb(c,d,e),b=this._getColorsByType(a,g),this._isValid(b)?b:this.getNew()},a.prototype._getTypeByProb=function(a,b,c){var g;return g=parseInt(100*Math.random()),g>=0&&a>g?e:g>=a&&b+a>=g?f:g>b+a&&b+a+c>g?d:console.log("error",g)},a.prototype._getColorsByType=function(a,b){switch(b){case e:return this._getThreeColorSame(a);case f:return this._getTwoColorSame(a);case d:return this._getNoColorSame(a)}},a.prototype._isValid=function(a){var b,c,d,e,f,g;for(c=f=0,g=a.length;g>f;c=++f)if(b=a[c],(d=this.brickCtrl.bc[c][0])&&(e=this.brickCtrl.bc[c][1])&&d.color===e.color&&d.color===b)return!1;return!0},a.prototype._getThreeColorSame=function(a){var b,c,d;switch(b=this._getRandomNum(a),c=this._getRandomNum(a,[b]),d=this._getRandomNum(2)){case 0:return[b,b,c,b];case 1:return[b,c,b,b]}},a.prototype._getTwoColorSame=function(a){var b,c,d,e;switch(b=this._getRandomNum(a),c=this._getRandomNum(a,[b]),d=this._getRandomNum(a,[b]),e=this._getRandomNum(6)){case 0:return[b,b,c,d];case 1:return[b,c,b,d];case 2:return[b,c,d,b];case 3:return[c,b,b,d];case 4:return[c,b,d,b];case 5:return[c,d,b,b]}},a.prototype._getNoColorSame=function(a){var b,c,d,e;return b=this._getRandomNum(a),c=this._getRandomNum(a,[b]),d=this._getRandomNum(a,[b,c]),e=this._getRandomNum(a,[b,c,d]),[b,c,d,e]},a.prototype._getRandomNum=function(a,b){var c;return null==b&&(b=[]),c=parseInt(Math.random()*a),-1===b.indexOf(c)?c:this._getRandomNum(a,b)},a}(),b.exports=c},{}],3:[function(a,b){var c,d,e,f,g;f=document.documentElement.clientHeight,g=document.documentElement.clientWidth,c=parseInt(f/10.5),e=["#fff","#3077bd","#ff6699","#993399","#cc66cc","#99ccff","#ffcccc","#000"],d=function(){function a(a,b,c,d,e,f){this.num=d,this.$wrapper=c,this.color=a,this.position=b,this.$dom=this._createDom(e,f),this._appendToParent(),this.isSmall=f}return a.prototype.up=function(a){var b;return null==a&&(a=1),b=this.position.y,b+=a,this.move(b)},a.prototype.down=function(a){var b;return null==a&&(a=1),b=this.position.y,b-=a,this.move(b)},a.prototype.move=function(a){var b,d;return this.position.y=a,b=this.position.x*c,d=-this.position.y*c,this.$dom.attr("data-y",a),this.$dom.css("-webkit-transform","translate3d("+b+"px, "+d+"px, 0)")},a.prototype.remove=function(a){var b;return this.isSmall?this.$dom.remove():(b=this.position.x>=a,this.$dom.addClass("brick-remove"),this._removeAnimation(this.$dom,b),setTimeout(function(a){return function(){return a.$dom.remove()}}(this),2e3))},a.prototype._removeAnimation=function(a,b){var d,e,f,g,h;return b?(g=this.position.x*c+15,d=-20,e=-90):(g=this.position.x*c-15,d=20,e=90),h=-this.position.y*c-10,this.$dom.css("z-index","10000000000"),this.$dom.css("-webkit-transform","translate3d("+g+"px, "+h+"px, 0) rotate("+d+"deg)"),this.$dom.css("-webkit-transition","all 0.2s ease-out"),f=this,setTimeout(function(){return f.$dom.css("-webkit-transition","all 0.4s ease-in"),f.$dom.css("-webkit-transform","translate3d("+g+"px, 100px, 0) rotate("+e+"deg)")},200)},a.prototype._createDom=function(a,b){var d,f,g,h;return f=a||c,d=$("<div class='brick'></div>"),d.css({backgroundColor:e[this.color],width:f,height:f,zIndex:this.num}),g=this.position.x*f,h=-this.position.y*f,d.css("-webkit-transform","translate3d("+g+"px, "+h+"px, 0)"),d.attr("data-x",this.position.x),d.attr("data-y",this.position.y),b&&d.addClass("small"),d},a.prototype._appendToParent=function(){return this.$wrapper.append(this.$dom)},a}(),b.exports=d},{}],4:[function(a,b){var c,d,e,f=function(a,b){return function(){return a.apply(b,arguments)}};c=a("./brick-controller.coffee"),e=a("./local-score.coffee"),d=function(){function a(){this.next=f(this.next,this),this.isStart=!1}return a.prototype.start=function(){return this.isStart?this.restart():(this.isStart=!0,this._initScreenSize(),this._initController(),this._initBricks(),this._onUserTap())},a.prototype.restart=function(){var a;return this.brickController.restart(),a=this,a._initBricks()},a.prototype.end=function(){return e.set(this.brickController.score),this.pages.showEnd(this.brickController.score)},a.prototype.next=function(){var a;return this.brickController.addNewRow(),a=this,setTimeout(function(){return a.brickController.rowsUp(),a.brickController.getAndShowNextRow()},10),setTimeout(function(){return a.brickController.checkIsEnd()?a.end():a.brickController.checkThreeNear()},300)},a.prototype._initScreenSize=function(){return this.height=document.documentElement.clientHeight,this.width=document.documentElement.clientWidth},a.prototype._initController=function(){return this.brickController=new c(this)},a.prototype._initBricks=function(){return this.brickController.getAndShowNextRow(),this.addNew(),this.brickController.getAndShowNextRow(),this.addNew(),this.brickController.getAndShowNextRow(),this.addNew(),this.brickController.getAndShowNextRow(),this.addNew(),this.brickController.getAndShowNextRow(),this.addNew(),this.brickController.getAndShowNextRow()},a.prototype._onUserTap=function(){return this.brickController.onTap()},a.prototype.addNew=function(){return this.brickController.addNewRow(),this.brickController.rowsUp()},a}(),b.exports=d},{"./brick-controller.coffee":1,"./local-score.coffee":5}],5:[function(a,b){var c;c=function(){function a(){localStorage.score||(localStorage.score=0)}return a.prototype.set=function(a){return localStorage.score?localStorage.score<a?localStorage.score=a:void 0:localStorage.score=a},a.prototype.get=function(){return localStorage.score},a}(),b.exports=new c},{}],6:[function(a){var b,c,d,e;b=a("./game.coffee"),c=a("./pages.coffee"),d=new b,e=new c(d),window.game=d,window.pages=e},{"./game.coffee":4,"./pages.coffee":7}],7:[function(a,b){var c,d,e;d=a("./local-score.coffee"),e=a("./share.coffee"),c=function(){function a(a){a.pages=this,this.game=a,this.initEvents(),this.$startPage=$("div#start-page"),this.$pausePage=$("div#pause-page"),this.$endPage=$("div#end-page"),this.$sharePage=$("div#share-page"),this.showHomePage()}return a.prototype.initEvents=function(){var a;return a=this,$("div#start")[0].addEventListener("touchstart",function(){return localStorage.hasEverPlay?(a.showGamePage(),a.game.start()):(a.showHowToPlayPage(),localStorage.hasEverPlay=!0)}),$("div#pause")[0].addEventListener("touchstart",function(){return console.log("pause"),a.showPause()}),$("div#continue")[0].addEventListener("touchstart",function(){return a.showGamePage()}),$("div#back-to-home")[0].addEventListener("touchstart",function(){return a.showHomePage(),console.log("back to home")}),$("div#replay")[0].addEventListener("touchstart",function(){return a.game.restart(),a.showGamePage()}),$("div#course")[0].addEventListener("touchstart",function(){return a.showHowToPlayPage()}),$("div#end-replay")[0].addEventListener("touchstart",function(){return a.game.restart(),a.showGamePage()}),$("div#share")[0].addEventListener("touchstart",function(){return a.showShare()}),$("div#end-share")[0].addEventListener("touchstart",function(){return a.showShare()}),$("div#share-page")[0].addEventListener("touchstart",function(){return a.$sharePage.hide()})},a.prototype.showHowToPlayPage=function(){var a,b,c;return console.log("localScore",d.hasEverPlay),c=this,a=$("div#how-to-play1"),b=$("div#how-to-play2"),a.show(),a[0].addEventListener("touchstart",function(){return b.show(),a.hide()}),b[0].addEventListener("touchstart",function(){return b.hide(),c.game.start(),c.showGamePage()})},a.prototype.showHomePage=function(){var a;return a=d.get(),$("h1#highest-score").text(a),this.hideEnd(),this.$startPage.show(),this.$pausePage.hide()},a.prototype.showGamePage=function(){return this.hideEnd(),this.$startPage.hide(),this.$pausePage.hide()},a.prototype.showPause=function(){return this.hideEnd(),this.$startPage.hide(),this.$pausePage.show()},a.prototype.showEnd=function(a){return window.endScore=a,this._setEndPageContent(a),this.$endPage.show(),this.$startPage.hide(),this.$pausePage.hide()},a.prototype.hideEnd=function(){return window.endScore=null,this.$endPage.hide()},a.prototype.showShare=function(){return this.$sharePage.show()},a.prototype._setEndPageContent=function(a){var b;return b=this._getRankContentByScore(a),$("span#final-score").text(a),$("p#final-rank").text(b)},a.prototype._getRankContentByScore=function(a){return a*=10,a>=0&&100>a?this._getContentOne(6):a>=100&&200>a?this._getContentOne(8):a>=200&&300>a?this._getContentOne(10):a>=300&&400>a?this._getContentOne(21):a>=500&&600>a?this._getContentOne(32):a>=600&&700>a?this._getContentOne(43):a>=700&&800>a?this._getContentOne(50):a>=800&&900>a?this._getContentOne(62):a>=900&&1e3>a?this._getContentOne(69):a>=1e3&&1100>a?this._getContentOne(73):a>=1100&&1200>a?this._getContentOne(79):a>=1200&&1400>a?this._getContentTwo(1200,1400,5e3,1e4,a):this._getContentTwo(1400,1600,2e3,5e3,a)},a.prototype._getContentOne=function(a){return"击败了全国"+a+"%的玩家"},a.prototype._getContentTwo=function(a,b,c,d,e){var f;return f=parseInt((d-c)/(b-a)*(e-a)+c),"排在全国"+f+"名"},a}(),b.exports=c},{"./local-score.coffee":5,"./share.coffee":8}],8:[function(a,b){var c,d;c=function(){function a(){this.data={img_url:"http://kuangwk.github.io/bb20/assets/images/icon.png",img_width:"120",img_height:"120",link:"http://kuangwk.github.io/bb21/",desc:"我是简单暴力之王，瞬间击碎了"+score+"块彩砖，不服来战！",title:"击碎砖块"}}return a.prototype.getShareFriendData=function(){var a;return a=window.endScore?window.endScore:localStorage.score,this.data.desc="我是简单暴力之王，瞬间击碎了"+a+"块彩砖，不服来战！",this.data.title="击碎砖块",this.data},a.prototype.getShareTimelineData=function(){var a;return a=window.endScore?window.endScore:localStorage.score,this.data.title="我是简单暴力之王，瞬间击碎了"+a+"块彩砖，不服来战！",this.data.desc="击碎砖块",this.data},a}(),d=window.share=new c,b.exports=d},{}]},{},[6]);
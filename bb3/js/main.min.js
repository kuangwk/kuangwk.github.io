!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){var c,d,e,f,g,h;h=4,g=10,c=50,d=a("./brick.coffee"),f=a("./brick-creator.coffee"),e=function(){function a(a){this.game=a,this.bc=this._initBrickCollection(),this.$wrapper=$("div#wrapper"),this.$score=$("span#score"),this.score=0,this.brickCreator=new f(this)}return a.prototype.addNewRow=function(){var a,b,c,e;for(console.log(this.brickCreator.getNew()),b=this._getNewRandomBrickNums(),e=[],a=c=0;3>=c;a=++c)e.push(this.bc[a][-1]=new d(b[a],{x:a,y:-1},this.$wrapper));return e},a.prototype.rowsUp=function(){var a,b,c,d,e;for(e=[],a=c=d=h-1;0>=d?0>=c:c>=0;a=0>=d?++c:--c)e.push(function(){var c,d,e;for(e=[],b=c=d=g-1;-1>=d?-1>=c:c>=-1;b=-1>=d?++c:--c)this.bc[a][b]?(this.bc[a][b].up(),this.bc[a][b+1]=this.bc[a][b],e.push(this.bc[a][b]=null)):e.push(void 0);return e}.call(this));return e},a.prototype.onTap=function(){var a;return a=this,this.$wrapper[0].addEventListener("touchstart",function(b){var c,d,e;return"brick"===b.target.className?(c=b.target,d=a._getPositionByDom(c),e=[],a._findAndReomveSameColorBricks(d,e),a._calculateFallDown(),setTimeout(function(){return a._findAndReomveMoreThanThreeNearByBricks(a.game.next)},300)):void 0})},a.prototype.checkThreeNear=function(){return this._findAndReomveMoreThanThreeNearByBricks()},a.prototype._calculateFallDown=function(){var a,b,c,d,e,f,i;for(i=[],c=e=0,f=h-1;f>=0?f>=e:e>=f;c=f>=0?++e:--e)i.push(function(){var e,f,h;for(h=[],d=e=0,f=g-1;f>=0?f>=e:e>=f;d=f>=0?++e:--e)this.bc[c][d]?h.push(void 0):(a=this._hasUpperBrick(c,d))?(b=a.position.y,this.bc[c][d]=a,this.bc[c][b]=null,h.push(a.down(a.position.y-d))):h.push(void 0);return h}.call(this));return i},a.prototype._hasUpperBrick=function(a,b){var c,d,e,f;for(c=d=e=b+1,f=g-1;f>=e?f>=d:d>=f;c=f>=e?++d:--d)if(this.bc[a][c])return this.bc[a][c];return null},a.prototype._removeBricks=function(a){var b,c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],this._scoreUp(),this.bc[b.x][b.y].remove(),e.push(this.bc[b.x][b.y]=null);return e},a.prototype._scoreUp=function(){return this.score+=1,this.$score.text(this.score)},a.prototype._findAndReomveMoreThanThreeNearByBricks=function(a){var b,c,d,e,f,i,j,k,l,m;for(e=[],f=j=0,l=h-1;l>=0?l>=j:j>=l;f=l>=0?++j:--j)for(i=k=0,m=g-1;m>=0?m>=k:k>=m;i=m>=0?++k:--k)c={x:f,y:i},(b=this.bc[f][i]&&!this._isPosInCollection(e,c))&&this._hasThreeSameColorBricks(c)&&(e.push(c),this._findNearBySameColorBricks(c,e));return e.length>0?(this._removeBricks(e),this._calculateFallDown(),d=this,setTimeout(function(){return d._findAndReomveMoreThanThreeNearByBricks(a)},300)):"function"==typeof a?a():void 0},a.prototype._hasThreeSameColorBricks=function(a){var b,c;return b=a.x,c=a.y,this._isVaildPosition({x:b,y:c+1})&&this._isVaildPosition({x:b,y:c+2})&&this._isTheSameColor(this.bc[b][c],this.bc[b][c+1])&&this._isTheSameColor(this.bc[b][c],this.bc[b][c+2])?!0:this._isVaildPosition({x:b+1,y:c})&&this._isVaildPosition({x:b+2,y:c})&&this._isTheSameColor(this.bc[b][c],this.bc[b+1][c])&&this._isTheSameColor(this.bc[b][c],this.bc[b+2][c])?!0:!1},a.prototype._findAndReomveSameColorBricks=function(a,b){return b.push(a),this._findNearBySameColorBricks(a,b),this._removeBricks(b)},a.prototype._findNearBySameColorBricks=function(a,b){return this._checkIsSameColorAndAdd(a,{x:a.x-1,y:a.y},b),this._checkIsSameColorAndAdd(a,{x:a.x+1,y:a.y},b),this._checkIsSameColorAndAdd(a,{x:a.x,y:a.y-1},b),this._checkIsSameColorAndAdd(a,{x:a.x,y:a.y+1},b)},a.prototype._checkIsSameColorAndAdd=function(a,b,c){var d,e;return this._isVaildPosition(b)&&(e=this.bc[b.x][b.y])&&!this._isPosInCollection(c,b)&&(d=this.bc[a.x][a.y],d.color===e.color)?(c.push(e.position),this._findNearBySameColorBricks(e.position,c)):void 0},a.prototype._isVaildPosition=function(a){return 0<=a.x&&a.x<=h-1&&0<=a.y&&a.y<=g-1},a.prototype._isTheSameColor=function(a,b){return a&&b?a.color===b.color:!1},a.prototype._getPositionByDom=function(a){var b,c;return b=parseInt($(a).attr("data-x")),c=parseInt($(a).attr("data-y")),{x:b,y:c}},a.prototype._isPosInCollection=function(a,b){var c,d,e;for(d=0,e=a.length;e>d;d++)if(c=a[d],c.x===b.x&&c.y===b.y)return!0;return!1},a.prototype._getNewRandomBrickNums=function(){var a,b,c;for(a=[],b=c=0;3>=c;b=++c)a.push(this._getRandomNum());return a},a.prototype._getRandomNum=function(){return parseInt(10*Math.random()/3)},a.prototype._initBrickCollection=function(){var a;return a=[],a[0]=[],a[1]=[],a[2]=[],a[3]=[],a},a}(),b.exports=e},{"./brick-creator.coffee":2,"./brick.coffee":3}],2:[function(a,b){var c,d,e,f,g;g=[0,1,2],e=g[0],f=g[1],d=g[2],c=function(){function a(a){this.brickCtrl=a}return a.prototype.getNew=function(){var a,b,c,d,e,f,g,h;return f=this.brickCtrl.score,f>=0&&199>=f&&(h=[0,0,100,7],c=h[0],d=h[1],e=h[2],a=h[3]),g=this._getTypeByProb(c,d,e),b=this._getColorsByType(a,g),console.log(this._isValid(b)),b},a.prototype._getTypeByProb=function(a,b,c){var g;return g=parseInt(100*Math.random()),g>=0&&a>g?e:g>=a&&b+a>=g?f:g>b+a&&b+a+c>g?d:console.log("error",g)},a.prototype._getColorsByType=function(a,b){switch(b){case e:return this._getThreeColorSame(a);case f:return this._getTwoColorSame(a);case d:return this._getNoColorSame(a)}},a.prototype._isValid=function(a){var b,c,d,e,f,g;for(c=f=0,g=a.length;g>f;c=++f)if(b=a[c],(d=this.brickCtrl.bc[c][0]&&(e=this.brickCtrl.bc[c][1]))&&d.color===e.color&&d.color===b)return!1;return!0},a.prototype._getThreeColorSame=function(a){var b,c,d;switch(console.log("three"),b=this._getRandomNum(a),c=this._getRandomNum(a,[b]),d=this._getRandomNum(2)){case 0:return[b,b,c,b];case 1:return[b,c,b,b]}},a.prototype._getTwoColorSame=function(a){var b,c,d,e;switch(console.log("tw0"),b=this._getRandomNum(a),c=this._getRandomNum(a,[b]),d=this._getRandomNum(a,[b]),e=this._getRandomNum(6)){case 0:return[b,b,c,d];case 1:return[b,c,b,d];case 2:return[b,c,d,b];case 3:return[c,b,b,d];case 4:return[c,b,d,b];case 5:return[c,d,b,b]}},a.prototype._getNoColorSame=function(a){var b,c,d,e;return console.log("diff"),b=this._getRandomNum(a),c=this._getRandomNum(a,[b]),d=this._getRandomNum(a,[b,c]),e=this._getRandomNum(a,[b,c,d]),[b,c,d,e]},a.prototype._getRandomNum=function(a,b){var c;return null==b&&(b=[]),c=parseInt(Math.random()*a),-1===b.indexOf(c)?c:this._getRandomNum(a,b)},a}(),b.exports=c},{}],3:[function(a,b){var c,d,e;c=50,e=["rgb(105, 219, 21)","rgb(243, 35, 192)","rgb(0, 174, 255)","rgb(255, 150, 1)"],d=function(){function a(a,b,c){this.$wrapper=c,this.color=a,this.position=b,this.$dom=this._createDom(),this._appendToParent()}return a.prototype.up=function(a){var b;return null==a&&(a=1),b=this.position.y,b+=a,this.move(b)},a.prototype.down=function(a){var b;return null==a&&(a=1),b=this.position.y,b-=a,this.move(b)},a.prototype.move=function(a){var b,d;return this.position.y=a,b=this.position.x*c,d=-this.position.y*c,this.$dom.attr("data-y",a),this.$dom.css("-webkit-transform","translate3d("+b+"px, "+d+"px, 0)")},a.prototype.remove=function(){return this.$dom.remove()},a.prototype._createDom=function(){var a,b,d;return a=$("<div class='brick'></div>"),a.css({backgroundColor:e[this.color]}),b=this.position.x*c,d=-this.position.y*c,a.css("-webkit-transform","translate3d("+b+"px, "+d+"px, 0)"),a.attr("data-x",this.position.x),a.attr("data-y",this.position.y),a},a.prototype._appendToParent=function(){return this.$wrapper.append(this.$dom)},a}(),b.exports=d},{}],4:[function(a,b){var c,d,e=function(a,b){return function(){return a.apply(b,arguments)}};c=a("./brick-controller.coffee"),d=function(){function a(){this.next=e(this.next,this)}return a.prototype.start=function(){return this._initController(),this._initBricks(),this._onUserTap()},a.prototype.next=function(){var a;return this.brickController.addNewRow(),a=this,setTimeout(function(){return a.brickController.rowsUp()},10),setTimeout(function(){return a.brickController.checkThreeNear()},300)},a.prototype._initController=function(){return this.brickController=new c(this)},a.prototype._initBricks=function(){return this.addNew(),this.addNew(),this.addNew(),this.addNew(),this.addNew()},a.prototype._onUserTap=function(){return this.brickController.onTap()},a.prototype.addNew=function(){return this.brickController.addNewRow(),this.brickController.rowsUp()},a}(),b.exports=d},{"./brick-controller.coffee":1}],5:[function(a){var b,c;b=a("./game.coffee"),c=new b,c.start()},{"./game.coffee":4}]},{},[5]);